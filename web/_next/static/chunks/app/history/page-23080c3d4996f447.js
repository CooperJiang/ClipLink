(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[429],{57643:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(95155),r=s(12115),i=s(51228),o=s(60136),c=s(26420),l=s(99749),n=s(14809);function d(){let[e,t]=(0,r.useState)([]),[s,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(),[m,g]=(0,r.useState)(!0),{showToast:f}=(0,n.d)(),[x,v]=(0,r.useState)(1),[b,p]=(0,r.useState)(1),[y,w]=(0,r.useState)(!1),[j,C]=(0,r.useState)(!1),N=(0,r.useCallback)(async function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1?arguments[1]:void 0;1===s?g(!0):w(!0);try{console.log("正在请求历史数据，页码: ".concat(s,", 页大小: ").concat(12).concat(a?", 类型: "+a:""));let r=await l.G.getClipboardHistory(s,12,a);if(console.log("服务器响应:",r),r.success&&r.data){let a=[],i=s,o=1;if(Array.isArray(r.data)?(a=r.data,i=s,o=1):"items"in r.data&&(a=r.data.items,i=r.data.page,o=r.data.totalPages),console.log("获取到 ".concat(a.length," 条记录，总页数: ").concat(o)),1===s)t(a);else{let s=new Set(e.map(e=>e.id)),r=a.filter(e=>!s.has(e.id));t(e=>[...e,...r])}v(i),p(o),C(i<o)}else f(r.message||"获取历史记录失败","error")}catch(e){console.error("获取历史记录失败:",e),f("获取历史记录失败","error")}finally{g(!1),w(!1)}},[f,e,12]),S=(0,r.useCallback)(()=>{x<b&&!y&&N(x+1)},[x,b,y,N]),k=(0,r.useCallback)(()=>{N(1)},[N]);(0,r.useEffect)(()=>{N(1)},[N]);let F=async e=>{if(window.confirm("确定要删除这个历史记录吗？"))try{let s=await l.G.deleteClipboard(e.id);s.success?(t(t=>t.filter(t=>t.id!==e.id)),f("删除成功","success")):f(s.message||"删除失败","error")}catch(e){f("删除失败","error")}},_=async e=>{try{let s=await l.G.toggleFavorite(e.id,!e.isFavorite);s.success&&s.data?(t(t=>t.map(t=>t.id===e.id?{...t,isFavorite:!t.isFavorite}:t)),f(e.isFavorite?"已取消收藏":"已添加到收藏","success")):f(s.message||"切换收藏状态失败","error")}catch(e){f("切换收藏状态失败","error")}},A=async e=>{if(u)try{let s=await l.G.updateClipboard(u.id,e);s.success&&s.data?(t(e=>e.map(e=>e.id===u.id?s.data:e)),f("保存成功","success")):f(s.message||"保存失败","error")}catch(e){throw console.error("保存失败:",e),f("保存失败","error"),e}};return(0,a.jsxs)(i.A,{children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg font-medium",children:"历史记录"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"查看您的剪贴板历史记录"})]}),(0,a.jsx)("button",{onClick:k,className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:"刷新"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,a.jsx)("div",{className:"h-full overflow-y-auto custom-scrollbar p-4",children:m?(0,a.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,a.jsx)("span",{className:"text-gray-400",children:"加载中..."})}):(0,a.jsx)(o.A,{items:e,onCopy:e=>{navigator.clipboard.writeText(e.content).then(()=>f("已复制到剪贴板","success")).catch(()=>{f("复制失败","error")})},onEdit:e=>{h(e),d(!0)},onDelete:F,onToggleFavorite:_,hasMore:j,onLoadMore:S,isLoadingMore:y})})}),(0,a.jsx)(c.A,{isOpen:s,onClose:()=>{d(!1),h(void 0)},onSave:A,initialData:u})]})}},88089:(e,t,s)=>{Promise.resolve().then(s.bind(s,57643))}},e=>{var t=t=>e(e.s=t);e.O(0,[266,181,220,908,608,441,684,358],()=>t(88089)),_N_E=e.O()}]);