# 运行脚本使用指南 (run.sh)

`run.sh` 是 ClipLink 应用的服务管理脚本，提供了完整的应用程序生命周期管理功能，包括启动、停止、重启、状态查看和日志管理。该脚本设计用于在部署环境中管理应用，提供了便捷的命令行接口。

## 功能概述

- **应用生命周期管理**：启动、停止、重启应用程序
- **状态监控**：检查应用程序运行状态、运行时间和端口监听情况
- **日志管理**：查看标准输出和错误日志，支持实时跟踪
- **数据库管理**：查看数据库信息和统计数据
- **智能二进制文件定位**：自动查找和使用正确的应用程序可执行文件
- **端口冲突处理**：检测并处理端口占用问题

## 基本用法

```bash
# 确保脚本有执行权限
chmod +x run.sh

# 启动应用（默认端口8080）
./run.sh start

# 使用指定端口启动
./run.sh start --port 3000

# 停止应用
./run.sh stop

# 重启应用
./run.sh restart

# 查看应用状态
./run.sh status

# 查看应用日志（最近50行）
./run.sh logs

# 查看错误日志
./run.sh error_logs

# 实时查看日志
./run.sh follow

# 查看数据库信息
./run.sh db_info

# 显示帮助信息
./run.sh help
```

## 命令详解

| 命令 | 说明 | 选项 |
|------|------|------|
| `start` | 启动应用程序 | `--port/-p <端口>`: 指定应用端口 |
| `stop` | 停止运行中的应用程序 | - |
| `restart` | 重启应用程序 | - |
| `status` | 显示应用程序运行状态 | - |
| `logs` | 查看应用程序日志 | `[行数]`: 显示指定行数（默认50） |
| `error_logs` | 查看错误日志 | `[行数]`: 显示指定行数（默认50） |
| `follow` | 实时跟踪应用程序日志 | - |
| `follow_error` | 实时跟踪错误日志 | - |
| `db_info` | 显示数据库位置、大小和表结构 | - |
| `help` | 显示帮助信息 | - |

## 流程详解

### 应用启动流程 (`start`)

1. 检查应用是否已在运行
2. 查找和验证可执行文件
3. 检查端口是否被占用，如被占用则询问是否释放
4. 使用 `nohup` 后台启动应用，将输出重定向到日志文件
5. 等待应用初始化，检查是否成功启动
6. 显示启动状态和可能的错误

### 应用停止流程 (`stop`)

1. 检查应用是否在运行
2. 向应用进程发送终止信号
3. 等待进程结束，如超时则发送强制终止信号
4. 删除PID文件，确认应用已停止

### 状态查看流程 (`status`)

1. 检查应用是否在运行
2. 显示PID和运行时间（如果正在运行）
3. 检查端口监听状态
4. 如果应用未运行，检查并显示是否有其他程序占用应用端口

### 数据库信息查看 (`db_info`)

1. 确定数据库文件位置（默认 `~/.cliplink/cliplink.db`）
2. 检查数据库文件是否存在并显示大小
3. 如果安装了 `sqlite3`，显示表结构和记录数量

## 文件和路径

- **应用程序**：脚本会查找当前目录下的 `cliplink` 或 `cliplink.exe` 文件
- **PID文件**：`./cliplink.pid`，用于跟踪应用进程ID
- **日志文件**：
  - 标准输出：`./cliplink.log`
  - 错误输出：`./cliplink_error.log`
- **数据库文件**：`~/.cliplink/cliplink.db`

## 注意事项

1. 脚本需要在包含应用程序二进制文件的目录中运行
2. 启动时会检查端口是否被占用，在确认后可以尝试释放端口
3. 停止应用时，如果应用未响应正常终止信号，将在10秒后尝试强制终止
4. 数据库文件默认存储在用户主目录的 `.cliplink` 子目录中

## 常见问题

1. **Q: 启动失败，提示找不到可执行文件**  
   A: 确保在包含 `cliplink` 可执行文件的目录中运行脚本，或使用完整路径

2. **Q: 端口被占用无法启动**  
   A: 使用 `./run.sh start --port <其他端口>` 尝试使用其他端口，或先停止占用该端口的程序

3. **Q: 应用无法停止**  
   A: 尝试使用 `ps aux | grep cliplink` 找到进程，然后使用 `kill -9 <PID>` 强制终止

4. **Q: 想要更改默认数据存储位置**  
   A: 目前数据库位置是硬编码的，修改需要更改源代码并重新编译

5. **Q: 在Windows系统上无法运行脚本**  
   A: 需要在类Unix环境中运行，Windows用户可以使用WSL、Git Bash或Cygwin 