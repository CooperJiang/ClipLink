# 剪贴板通道隔离设计与API文档

## 通道隔离设计

为了解决剪贴板内容的隐私和安全问题，我们实现了通道隔离机制，将不同用户的剪贴板内容进行隔离。这种设计具有以下特点：

1. **轻量级**：无需复杂的用户注册、登录系统
2. **易用性**：用户只需记住一个通道ID即可在多设备间共享内容
3. **安全性**：不同通道之间的内容相互隔离，无法越权访问

## 通道ID说明

通道ID是一个最长64位的字符串，用于标识不同的用户空间。用户可以：

1. 自定义通道ID（最长64位）
2. 让系统自动生成一个随机通道ID

所有API请求（创建和验证通道除外）都需要在请求头中包含通道ID，以确保只能访问自己的内容。

## 新增API接口

### 1. 创建通道

- **请求方法**：`POST`
- **请求路径**：`/api/channel`
- **请求参数**：

  ```json
  {
    "channel_id": "my-custom-channel"  // 可选，不提供则自动生成
  }
  ```

- **响应数据**：

  ```json
  {
    "code": 200,
    "message": "创建通道成功",
    "data": {
      "id": "my-custom-channel",
      "created_at": "2023-06-01T12:00:00Z"
    }
  }
  ```

### 2. 验证通道

- **请求方法**：`POST`
- **请求路径**：`/api/channel/verify`
- **请求参数**：

  ```json
  {
    "channel_id": "my-custom-channel"  // 必填
  }
  ```

- **响应数据**：
  
  成功验证：
  ```json
  {
    "code": 200,
    "message": "通道验证成功"
  }
  ```
  
  通道不存在：
  ```json
  {
    "code": 404,
    "message": "通道不存在"
  }
  ```

## 通道ID认证方式

所有API请求（创建和验证通道除外）都需要在请求头中包含通道ID：

```
X-Channel-ID: my-custom-channel
```

如果请求没有提供通道ID或提供的通道ID不存在，API将按以下规则处理：

1. 不提供通道ID：访问公共区域（没有绑定通道的内容）
2. 提供不存在的通道ID：返回空结果（不会报错）

## 现有API变更

所有现有API接口的行为保持不变，但现在需要在请求头中包含`X-Channel-ID`字段来指定通道ID。所有API操作都会基于指定的通道进行过滤，确保用户只能访问自己通道内的内容。

例如，获取最新剪贴板内容：

```
GET /api/clipboard
X-Channel-ID: my-custom-channel
```

响应将只返回该通道下的最新剪贴板内容。

## 前端集成

前端应用需要做如下修改来支持通道隔离：

1. 添加通道创建/验证页面，供用户创建或输入通道ID
2. 将通道ID保存在本地存储（localStorage或类似机制）
3. 确保每个API请求都在请求头中包含`X-Channel-ID`字段
4. 在多设备上使用相同的通道ID来实现内容共享

## 安全考虑

1. 通道ID应当保密，不要轻易分享
2. 为增强安全性，可以考虑定期更换通道ID
3. 对于特别敏感的内容，建议使用更复杂的通道ID

## 技术实现

此功能的实现涉及以下变更：

1. 添加新的数据模型：`Channel`
2. 剪贴板模型添加`channel_id`字段
3. 所有查询添加通道过滤条件
4. 添加通道创建和验证API接口
5. 添加请求头中通道ID的提取和验证逻辑 